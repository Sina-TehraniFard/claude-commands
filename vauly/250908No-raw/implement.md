---
description: "設計書とテスト設計書に基づいて実装を行います"
argument-hint: "[機能名]"
allowed-tools: Bash(find:*), Bash(grep:*), Bash(cat:*), Bash(git:status), Bash(git:diff), Bash(head:*)
model: claude-3-5-sonnet-20241022
---

# /implement - 実装実行コマンド

機能「$ARGUMENTS」について、設計書とテスト設計書に厳密に従って実装を行います。

## 実行手順

### 1. 引数の判定と要件取得
引数「$ARGUMENTS」の形式を判定して適切な取得方法を選択：

#### UUID形式の場合（推奨）:
- **設計書取得**: ReadMcpResourceTool(server: "report-manager", uri: "report://$ARGUMENTS")
- **テスト設計取得**: 設計書から関連するtest-design-uuidを特定し取得
- 直接的なリソースアクセスで高速・確実

#### 機能名形式の場合:
- MCPサーバーでfeature_name検索を実行
- plan-uuid → test-design-uuid の順で関連リソースを特定
- フォールバック: ローカル検索での設計書・テスト設計書検索

### 2. 関連リソースの連鎖取得
取得したメインリソースから関連情報を順次取得：

#### 設計書ベースの場合:
1. 設計書メタデータから関連test-design-uuidを取得
2. ReadMcpResourceTool(server: "report-manager", uri: "report://test-design-{uuid}")
3. 実装に必要な全情報を集約

#### エラーハンドリング:
- リソースが見つからない場合の適切なエラーメッセージ
- 不完全な関連付けの検出と報告
- フォールバック検索の実行

### 2. 現在の実装状況確認
- Git状況: !`git status`
- ソースファイル一覧: !`find . -name "*.js" -o -name "*.ts" -o -name "*.py" -o -name "*.go" | grep -v node_modules | grep -v .git`

### 3. 実装方針の確認
設計書から以下を再確認：
- **実装スコープ**: 設計書記載範囲のみ
- **除外事項**: 設計書に記載されていない機能
- **完了条件**: 設計書のチェックリスト

### 4. テスト先行実装（Test-First）
テスト設計書に基づいてテストコードを実装：

#### 4-1. テストファイル作成
適切なテストファイル名でテストを作成（プロジェクトの慣例に従う）

#### 4-2. テストケース実装
- 正常系テスト: 設計書の仕様通りの動作
- 異常系テスト: 設計書定義のエラーハンドリング  
- 境界値テスト: 設計書記載の境界条件のみ

#### 4-3. テスト実行確認
初回は全てFAILすることを確認

### 5. 本体機能実装
設計書の実装チェックリストに沿って実装：

#### 5-1. コア機能実装
- インターフェース定義通りの実装
- データ構造は設計書の通り
- 処理フローは設計書の通り

#### 5-2. エラーハンドリング実装
- 設計書定義のエラー条件のみ
- エラーメッセージは設計書記載通り

#### 5-3. テスト実行・修正
各実装段階でテストを実行し、PASSすることを確認

### 6. 実装完了確認
設計書の実装チェックリストを全て満たしているか確認

### 7. 実装レビュー
以下を自己チェック：
- **スコープ遵守**: 設計書の範囲を超えていない
- **仕様準拠**: 設計書通りの動作
- **テスト網羅**: テスト設計書の全ケースをカバー
- **不要機能なし**: 設計書にない機能を追加していない

### 8. 実装完了レポートのMCP保存
実装完了後、結果をMCPサーバーにレポートとして保存：
- 実装レポート: 完了状況、テスト結果、変更ファイル一覧
- 関連リソース更新: 設計書・テスト設計書の実装状況を更新
- ワークフロー完了: 設計→テスト設計→実装の完全なトレーサビリティ確保

## 制約事項
- **絶対に設計書の範囲を超えない**
- テスト設計書にないテストは追加しない  
- 設計書で「今回実装しない」とされた機能は触らない
- 「将来的な拡張」を考慮した実装はしない
- 設計書で不明な点があれば実装を止めて確認を求める
- **全ドキュメントはMCPサーバーで統一管理**

## エラー時の対応
実装中に設計書で想定されていない問題が発生した場合：
1. 実装を一時停止
2. 問題内容を明確に報告  
3. 設計書の修正が必要かを確認
4. 修正後に実装再開