---
description: "設計書に基づいて単体テストの設計を行います"
argument-hint: "[設計書名]"
allowed-tools: Bash(find:*), Bash(grep:*), Bash(cat:*), Bash(head:*)
model: claude-3-5-sonnet-20241022
---

# /uni-test-design - テスト設計コマンド

設計書「$ARGUMENTS」に基づいて、設計書の範囲内でのみ単体テストを設計します。

## 実行手順

### 1. 引数の判定と設計書取得
引数「$ARGUMENTS」の形式を判定して適切な取得方法を選択：

#### UUID形式の場合（推奨）:
- **ReadMcpResourceTool**(server: "report-manager", uri: "report://$ARGUMENTS")でレポート直接取得
- 設計書リソースを即座に取得・解析
- 高速でエラーが少ない取得方法

#### 機能名形式の場合:
- MCPサーバーでfeature_name検索を実行
- 複数候補がある場合は最新のplan-uuidを選択
- フォールバック: ローカル検索 !`find design_docs/ -name "*$ARGUMENTS*" -type f`

### 2. 設計書の解析とスコープ抽出
取得したレポート/設計書から以下を抽出：
- **テスト対象**: 設計書で定義された機能のみ
- **テスト境界**: 設計書のスコープ外は対象外
- **成功条件**: 設計書記載の成功基準
- **失敗条件**: 設計書記載のエラーハンドリング
- **除外事項**: 明示的に「今回実装しない」とされた機能

### 2. テスト範囲の特定
設計書から以下を抽出：
- **テスト対象**: 設計書で定義された機能のみ
- **テスト境界**: 設計書のスコープ外は対象外
- **成功条件**: 設計書記載の成功基準
- **失敗条件**: 設計書記載のエラーハンドリング

### 3. テスト設計書作成とMCP保存
MCPサーバーにテスト設計書をリソースとして保存：

#### MCP保存形式
- **Resource ID**: `test-design-{generated-uuid}`  
- **Resource Type**: `test-design-document`
- **Content**: 下記のテスト設計書構造に従ったMarkdown形式

#### テスト設計書構造
```markdown
# [機能名] テスト設計書

## 参照リソース
**設計書**: ReadMcpResourceTool(server: "report-manager", uri: "report://{plan-uuid}")
**テスト設計**: ReadMcpResourceTool(server: "report-manager", uri: "report://{test-design-uuid}")

## テスト方針
- 設計書記載範囲のみテスト
- 設計書外の機能は対象外
- 境界値テストは必要最小限

## 単体テストケース

### 正常系テスト
| テストケース名 | 入力 | 期待結果 | 設計書根拠 |
|---|---|---|---|
| [ケース1] | [入力値] | [期待値] | [設計書の該当箇所] |

### 異常系テスト  
| テストケース名 | 入力 | 期待結果 | 設計書根拠 |
|---|---|---|---|
| [ケース1] | [異常入力] | [エラー内容] | [設計書の該当箇所] |

### 境界値テスト
| テストケース名 | 入力 | 期待結果 | 設計書根拠 |
|---|---|---|---|
| [ケース1] | [境界値] | [期待値] | [設計書の該当箇所] |

## テスト実装指針
- テストフレームワーク: [プロジェクトの標準]
- モック対象: [外部依存のみ]
- テストデータ: [最小限のサンプル]
- アサーション: [設計書記載の条件のみ]

## 実装すべきでないテスト
- 設計書に記載されていない機能のテスト
- 過度な境界値テスト
- パフォーマンステスト（設計書で要求されない限り）
- 統合テスト的なテスト
```

### 4. 既存テストコードとの整合性確認
現在のテストファイルを確認：
- テストファイル一覧: !`find . -name "*test*" -o -name "*spec*" | grep -E "\.(js|ts|py|go)$" | head -10`

### 6. テスト設計書のMCP保存
作成したテスト設計書もMCPサーバーに保存：
- テスト設計書保存: MCPリソースとして保存
- 設計書との関連付け: 参照元設計書のplan-uuidと紐付け
- 後続実装での活用: implementコマンドでの参照を可能に

## 注意事項
- 設計書に記載されていない機能のテストは作成禁止
- テストが設計書の意図を正しく表現しているか確認
- 過度に詳細なテストは避け、設計書レベルの粒度を保つ
- 全てのドキュメントはMCPサーバーで一元管理